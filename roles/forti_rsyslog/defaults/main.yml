# --- Syslog listener options ---
forti_syslog_enable_udp: true
forti_syslog_enable_tcp: false
forti_syslog_udp_port: 514
forti_syslog_tcp_port: 5514

# Empty string means "all interfaces". Examples: "0.0.0.0", "::", "192.168.1.10"
forti_syslog_listen_address: ""

# Optional: restrict sender IPs. If empty, accept from anyone who can reach the port.
forti_syslog_allowed_senders: []

# --- Log storage (paths adjustable) ---
forti_log_dir: /var/log/fortinet
forti_log_filename: fortigate.log
forti_log_path: "{{ forti_log_dir }}/{{ forti_log_filename }}"

forti_log_dir_mode: "0750"
forti_log_file_mode: "0640"
forti_log_owner: syslog
forti_log_group: syslog

# --- Log retention / rotation (duration adjustable) ---
forti_logrotate_frequency: daily   # daily/weekly/monthly/yearly
forti_log_retention_days: 1        # used when frequency=daily

# logrotate "rotate" is "how many rotated files to keep"
# If you rotate daily, rotate == retention days.
forti_logrotate_rotate: "{{ forti_log_retention_days if forti_logrotate_frequency == 'daily' else 12 }}"

forti_logrotate_compress: true
forti_logrotate_delaycompress: true
forti_logrotate_copytruncate: true

# --- Performance tuning (reduce Wazuh load) ---
# Tuning mode: "1" (source_filter), "2" (split_traffic), "3" (wazuh_light), "auto" (opt-in auto detect)
forti_tuning_mode: "2"

# Patterns that identify high-volume traffic logs (modes 1 and 2).
forti_syslog_traffic_patterns:
  - "type=traffic"

# Split-traffic mode: separate log path for traffic-only events.
forti_traffic_log_filename: fortigate-traffic.log
forti_traffic_log_path: "{{ forti_log_dir }}/{{ forti_traffic_log_filename }}"
forti_traffic_log_owner: "{{ forti_log_owner }}"
forti_traffic_log_group: "{{ forti_log_group }}"
forti_traffic_log_mode: "{{ forti_log_file_mode }}"

# Split-traffic mode: optional Filebeat input for traffic logs.
forti_traffic_filebeat_manage: null  # null = auto (enabled for split_traffic)
forti_traffic_filebeat_enabled: true
forti_traffic_filebeat_config_path: /etc/filebeat/filebeat.yml
forti_traffic_filebeat_inputs_manage: true
forti_traffic_filebeat_inputs_dir: /etc/filebeat/inputs.d
forti_traffic_filebeat_inputs_file: /etc/filebeat/inputs.d/fortinet-traffic.yml
forti_traffic_filebeat_inputs_glob: /etc/filebeat/inputs.d/*.yml
forti_traffic_filebeat_inputs_reload: false
forti_traffic_filebeat_input_type: log
forti_traffic_filebeat_restart: true
forti_traffic_filebeat_fields_under_root: true
forti_traffic_filebeat_fields:
  event:
    module: fortinet
    dataset: fortinet.traffic
forti_traffic_filebeat_tags:
  - fortinet
  - traffic

# --- Backfill (optional) ---
# If null, backfill auto-enables when all backfill values are set.
forti_backfill_enable: null
forti_backfill_source_path: ""
forti_backfill_output_path: ""
forti_backfill_start: ""
forti_backfill_end: ""
forti_backfill_force: false
forti_backfill_owner: "{{ forti_log_owner }}"
forti_backfill_group: "{{ forti_log_group }}"
forti_backfill_mode: "{{ forti_log_file_mode }}"
forti_backfill_manage_localfile: true
forti_backfill_log_format: "{{ forti_wazuh_log_format }}"
forti_backfill_cleanup_localfile: false
forti_backfill_cleanup_file: false

# --- Wazuh archives logrotate (separate retention) ---
forti_wazuh_archives_logrotate_manage: true
forti_wazuh_archives_logrotate_conf_path: /etc/logrotate.d/wazuh-archives
forti_wazuh_archives_log_path: /var/ossec/logs/archives/archives.json
forti_wazuh_archives_log_owner: wazuh
forti_wazuh_archives_log_group: wazuh
forti_wazuh_archives_log_mode: "0660"
forti_wazuh_archives_logrotate_frequency: "{{ forti_logrotate_frequency }}"
forti_wazuh_archives_log_retention_days: 7
forti_wazuh_archives_logrotate_rotate: "{{ forti_wazuh_archives_log_retention_days if forti_wazuh_archives_logrotate_frequency == 'daily' else 12 }}"
forti_wazuh_archives_logrotate_compress: "{{ forti_logrotate_compress }}"
forti_wazuh_archives_logrotate_delaycompress: "{{ forti_logrotate_delaycompress }}"
forti_wazuh_archives_logrotate_copytruncate: "{{ forti_logrotate_copytruncate }}"

# --- Config file locations ---
forti_rsyslog_conf_path: /etc/rsyslog.d/10-fortinet.conf
forti_logrotate_conf_path: /etc/logrotate.d/fortinet-syslog

# --- Service names ---
rsyslog_service_name: rsyslog

# --- Health checks ---
# Validate rsyslog service state, listener ports, and log path after configuration.
forti_rsyslog_healthcheck: true
# If true, fail the play on health check issues; if false, emit warnings only.
forti_rsyslog_healthcheck_fail: true
# Delay (seconds) before checking listeners after handler flush.
forti_rsyslog_healthcheck_delay: 2
# Retry settings to avoid transient listener checks.
forti_rsyslog_healthcheck_retries: 5
forti_rsyslog_healthcheck_retry_delay: 1

# --- Wazuh integration ---
forti_wazuh_manage: true
forti_wazuh_ossec_conf_path: /var/ossec/etc/ossec.conf
forti_wazuh_manager_service_name: wazuh-manager
forti_wazuh_log_format: syslog

# --- Wazuh manager tuning (optional) ---
# If null, tuning auto-enables when any tuning list is non-empty.
forti_wazuh_tuning_manage: null
# Disable specific Wazuh modules (wodle/module name values).
forti_wazuh_disable_modules: []
# If null, ruleset tuning auto-enables when any ruleset list is non-empty.
forti_wazuh_ruleset_manage: null
# Exclude noisy rules/decoders to reduce analysis load.
forti_wazuh_ruleset_rule_excludes: []
forti_wazuh_ruleset_decoder_excludes: []
# Auto-exclude Fortinet rules to reduce alert noise (high/critical can be added via local rules).
forti_wazuh_ruleset_exclude_forti: true
forti_wazuh_ruleset_exclude_forti_patterns:
  - "*fortigate*"
  - "*fortinet*"
forti_wazuh_root: /var/ossec
forti_wazuh_ruleset_dirs:
  - "{{ forti_wazuh_root }}/ruleset/rules"
  - "{{ forti_wazuh_root }}/etc/rules"

# --- Fortinet high/critical alerts (Wazuh local rules) ---
# If null, auto-enable when Fortinet rules are excluded.
forti_wazuh_fortinet_alerts_manage: null
forti_wazuh_fortinet_alerts_levels:
  - 12
  - 13
  - 14
  - 15
forti_wazuh_fortinet_alerts_match_field: "level"
forti_wazuh_fortinet_alerts_rules_path: "{{ forti_wazuh_root }}/etc/rules/forti-alerts.xml"
forti_wazuh_fortinet_alerts_rule_id_base: 100300

# Ensure archive settings are enabled in ossec.conf (global section).
forti_wazuh_manage_logall: true
forti_wazuh_logall: "yes"
forti_wazuh_manage_logall_json: true
forti_wazuh_logall_json: "yes"

# Optional: manage Filebeat Wazuh module archives shipping.
forti_wazuh_filebeat_manage: false
forti_wazuh_filebeat_module_path: /etc/filebeat/modules.d/wazuh.yml
forti_wazuh_filebeat_archives_enabled: false
forti_wazuh_filebeat_archives_paths:
  - /var/ossec/logs/archives/archives.json
# Archives severity control: default clears rule.level from archives events.
# Set false to keep severity, or use the mode override below.
forti_wazuh_archives_clear_severity: true
# Mode override (highest priority): "drop" (remove rule.level), "zero" (set rule.level=0), "keep" (preserve).
forti_wazuh_archives_severity_mode: "drop"
# Legacy boolean override (deprecated): true keeps rule.level; false drops it.
forti_wazuh_archives_include_severity: null

# --- Wazuh archives ingest pipeline (optional) ---
forti_wazuh_archives_pipeline_manage: false
forti_wazuh_opensearch_url: ""
forti_wazuh_opensearch_auth_method: basic  # basic | token | none
forti_wazuh_opensearch_username: ""
forti_wazuh_opensearch_password: ""
forti_wazuh_opensearch_token: ""
forti_wazuh_opensearch_validate_certs: true
# If empty, the role will try to auto-detect the archives pipeline by name match.
forti_wazuh_archives_pipeline_name: ""
forti_wazuh_archives_pipeline_match: "wazuh-archives"
forti_wazuh_filebeat_config_path: /etc/filebeat/filebeat.yml
forti_wazuh_filebeat_inputs_manage: true
forti_wazuh_filebeat_inputs_dir: /etc/filebeat/inputs.d
forti_wazuh_filebeat_inputs_file: /etc/filebeat/inputs.d/wazuh-archives.yml
forti_wazuh_filebeat_inputs_glob: /etc/filebeat/inputs.d/*.yml
forti_wazuh_filebeat_inputs_reload: false
forti_wazuh_filebeat_input_type: log
forti_wazuh_filebeat_restart: true
forti_filebeat_service_name: filebeat

# Optional: manage Wazuh Dashboards index pattern for archives.
forti_wazuh_dashboards_manage: false
forti_wazuh_dashboards_url: ""
forti_wazuh_dashboards_auth_method: basic  # basic | token | none
forti_wazuh_dashboards_username: ""
forti_wazuh_dashboards_password: ""
forti_wazuh_dashboards_token: ""
forti_wazuh_dashboards_version: "2.x"
forti_wazuh_dashboards_validate_certs: true
forti_wazuh_dashboards_timezone: "Etc/GMT-3"
forti_wazuh_dashboards_tenant: ""
forti_wazuh_dashboards_archives_pattern: "wazuh-archives-*"
forti_wazuh_dashboards_archives_pattern_id: "wazuh-archives-*"
forti_wazuh_dashboards_archives_time_field: "timestamp"

# The localfile block will be inserted before the closing ossec_config tag
forti_wazuh_insert_before_regex: "</ossec_config>"

# Fail the play if the ossec.conf path doesn't exist.
# Set to false if you want the role to configure rsyslog only.
forti_wazuh_fail_if_missing: true
