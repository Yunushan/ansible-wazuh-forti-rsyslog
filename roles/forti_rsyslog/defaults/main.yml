# --- Syslog listener options ---
forti_syslog_enable_udp: true
forti_syslog_enable_tcp: false
forti_syslog_udp_port: 514
forti_syslog_tcp_port: 5514

# Empty string means "all interfaces". Examples: "0.0.0.0", "::", "192.168.1.10"
forti_syslog_listen_address: ""

# Optional: restrict sender IPs. If empty, accept from anyone who can reach the port.
forti_syslog_allowed_senders: []

# --- Log storage (paths adjustable) ---
forti_log_dir: /var/log/fortinet
forti_log_filename: fortigate.log
forti_log_path: "{{ forti_log_dir }}/{{ forti_log_filename }}"

forti_log_dir_mode: "0750"
forti_log_file_mode: "0640"
forti_log_owner: syslog
forti_log_group: syslog

# --- Log retention / rotation (duration adjustable) ---
forti_logrotate_frequency: daily   # daily/weekly/monthly/yearly
forti_log_retention_days: 1        # used when frequency=daily

# logrotate "rotate" is "how many rotated files to keep"
# If you rotate daily, rotate == retention days.
forti_logrotate_rotate: "{{ forti_log_retention_days if forti_logrotate_frequency == 'daily' else 12 }}"

forti_logrotate_compress: true
forti_logrotate_delaycompress: true
forti_logrotate_copytruncate: true

# --- Wazuh archives logrotate (separate retention) ---
forti_wazuh_archives_logrotate_manage: true
forti_wazuh_archives_logrotate_conf_path: /etc/logrotate.d/wazuh-archives
forti_wazuh_archives_log_path: /var/ossec/logs/archives/archives.json
forti_wazuh_archives_log_owner: wazuh
forti_wazuh_archives_log_group: wazuh
forti_wazuh_archives_log_mode: "0660"
forti_wazuh_archives_logrotate_frequency: "{{ forti_logrotate_frequency }}"
forti_wazuh_archives_log_retention_days: 14
forti_wazuh_archives_logrotate_rotate: "{{ forti_wazuh_archives_log_retention_days if forti_wazuh_archives_logrotate_frequency == 'daily' else 12 }}"
forti_wazuh_archives_logrotate_compress: "{{ forti_logrotate_compress }}"
forti_wazuh_archives_logrotate_delaycompress: "{{ forti_logrotate_delaycompress }}"
forti_wazuh_archives_logrotate_copytruncate: "{{ forti_logrotate_copytruncate }}"

# --- Config file locations ---
forti_rsyslog_conf_path: /etc/rsyslog.d/10-fortinet.conf
forti_logrotate_conf_path: /etc/logrotate.d/fortinet-syslog

# --- Service names ---
rsyslog_service_name: rsyslog

# --- Health checks ---
# Validate rsyslog service state, listener ports, and log path after configuration.
forti_rsyslog_healthcheck: true
# If true, fail the play on health check issues; if false, emit warnings only.
forti_rsyslog_healthcheck_fail: true
# Delay (seconds) before checking listeners after handler flush.
forti_rsyslog_healthcheck_delay: 2
# Retry settings to avoid transient listener checks.
forti_rsyslog_healthcheck_retries: 5
forti_rsyslog_healthcheck_retry_delay: 1

# --- Wazuh integration ---
forti_wazuh_manage: true
forti_wazuh_ossec_conf_path: /var/ossec/etc/ossec.conf
forti_wazuh_manager_service_name: wazuh-manager
forti_wazuh_log_format: syslog

# Ensure archive settings are enabled in ossec.conf (global section).
forti_wazuh_manage_logall: true
forti_wazuh_logall: "yes"
forti_wazuh_manage_logall_json: true
forti_wazuh_logall_json: "yes"

# Optional: manage Filebeat Wazuh module archives shipping.
forti_wazuh_filebeat_manage: false
forti_wazuh_filebeat_module_path: /etc/filebeat/modules.d/wazuh.yml
forti_wazuh_filebeat_archives_enabled: false
forti_wazuh_filebeat_archives_paths:
  - /var/ossec/logs/archives/archives.json
# If false, drop rule.level from archives events to avoid severity grouping.
forti_wazuh_archives_include_severity: false
forti_wazuh_filebeat_config_path: /etc/filebeat/filebeat.yml
forti_wazuh_filebeat_inputs_manage: true
forti_wazuh_filebeat_inputs_dir: /etc/filebeat/inputs.d
forti_wazuh_filebeat_inputs_file: /etc/filebeat/inputs.d/wazuh-archives.yml
forti_wazuh_filebeat_inputs_glob: /etc/filebeat/inputs.d/*.yml
forti_wazuh_filebeat_inputs_reload: false
forti_wazuh_filebeat_input_type: log
forti_wazuh_filebeat_restart: true
forti_filebeat_service_name: filebeat

# Optional: manage Wazuh Dashboards index pattern for archives.
forti_wazuh_dashboards_manage: false
forti_wazuh_dashboards_url: ""
forti_wazuh_dashboards_auth_method: basic  # basic | token | none
forti_wazuh_dashboards_username: ""
forti_wazuh_dashboards_password: ""
forti_wazuh_dashboards_token: ""
forti_wazuh_dashboards_version: "2.x"
forti_wazuh_dashboards_validate_certs: true
forti_wazuh_dashboards_timezone: "Etc/GMT-3"
forti_wazuh_dashboards_tenant: ""
forti_wazuh_dashboards_archives_pattern: "wazuh-archives-*"
forti_wazuh_dashboards_archives_pattern_id: "wazuh-archives-*"
forti_wazuh_dashboards_archives_time_field: "timestamp"

# The localfile block will be inserted before the closing ossec_config tag
forti_wazuh_insert_before_regex: "</ossec_config>"

# Fail the play if the ossec.conf path doesn't exist.
# Set to false if you want the role to configure rsyslog only.
forti_wazuh_fail_if_missing: true
